---
title: "Marathon Training Plan Data Analysis - Philly 2017"
author: "Steve Newns"
date: 2017-1-02T21:13:14-05:00
categories: ["R"]
tags: ["R Markdown", "plot", "running","marathon","philadelphia","distance running","training"]
#output:
 #pdf_document:
  #fig_caption: yes
---

Marathons hurt and wind is the embodiment of all that is evil. That's what I've learned from the two marathons I've run thus far. Case in point:

<center>
*1st Marathon ever:*
![](./strava_marathon_16.PNG)

*Not much has changed:*
![](./strava_marathon_17.PNG)
</center>
<br>
<br>
Last year, I followed the 18-week, 55-70 mile plan from [<u>Pete Pfitzinger's Advanced Marathoning</u>](https://smile.amazon.com/Advanced-Marathoning-2nd-Pete-Pfitzinger/dp/0736074600). I blew up pretty bad around mile 20 to mile 22 (I don't remember, exactly, *because. it. hurt.*), as is apparently typical of beginner marathoners that aren't sure of if/when they'll hit the dreaded Wall and not being prepared for it. I remember my calves screaming and my hips almost fully tightening up in that last 10k. From this I just assumed that maybe I just didn't have the muscular endurance to last the whole race, as I felt I was holding a pretty comfortably-hard pace prior to entering the pain cave. I decided to pick a higher mileage plan in hopes of remedying this, so I went with a sort-of ad-hoc modification based off of the 18 week 85 mile and 18 week, more than 85 mile plans from the same book, with most workouts taken as-is from the 85+ mile plan, with some extra miles here and there on some runs depending on how I felt at the time.

```{r load dataset, echo = FALSE, message = FALSE, warning=FALSE}
library(tidyverse) # data cleaning and manipulation
library(ggplot2) # plotting
library(lubridate) # dates
library(RColorBrewer) # plotting
library(magrittr) # pipe operations
library(knitr) # kable()

## load in data files for both races
philly17 <- read.csv("../../Data/2017/cleanedMarathonTrainingData_philly17.csv", stringsAsFactors = F)
philly16 <- read.csv("../../Data/2016/cleanedMarathonTrainingData_philly16.csv", stringsAsFactors = F)

# random missing month value?
philly16[17,"Month"] <- "Aug"

## combine into 1 dataset and remove redundant row
philly <- rbind(philly16,philly17)
philly %<>% select(-X) %>%
  mutate(MarathonName = if_else(Marathon == "ph16","Philly 2016","Philly 2017"),
         # make POSIXct again
         Time = as.POSIXct(Time),
         Avg.Pace = as.POSIXct(Avg.Pace),
         Best.Pace = as.POSIXct(Best.Pace),
         Date = as.POSIXct(Date),
         StartTime = as.POSIXct(StartTime),
         # make Month an ordered factor
         Month = factor(Month, ordered = TRUE, 
                        levels = c("Jul","Aug","Sep","Oct","Nov")))

#glimpse(philly)
philly %>%
  group_by(MarathonName) %>%
  summarize(Count = n()) %>%
  kable()
```

There were a lot more runs and not just miles in this year's prep. This was pretty much all due to the double days (pretty much all double recovery runs), as well as the warm up and cool downs of two tune-up race workouts that for some reason I decided to count as separate activities. And even though I missed some days completely due to some injuries, I still had almost 40 more runs in this time around. I got hit with a real sharp quad pain around the middle of September and popped back up in October that *forced* my stubborn self to take some days off. I believe that I sustained this injured thanks to my impatient and running my "easy" runs too hard while also not having as long of a base-building period prior to this marathon plan compared to last year.

### *Miles*

I'll start off with a simple histogram of how many miles I ran throughout each marathon prep.

```{r plotting, echo = FALSE, fig.align='center'}
#distance histogram
ggplot(data = philly, aes(x = Distance)) + 
  geom_histogram(binwidth = 2, aes(fill = ..count..), colour = "black", boundary = 2) +
  theme_bw() + 
  scale_x_continuous(limits = c(0, 30)) +
  xlab("Distance (mi)") + 
  ylab("Frequency") + 
  ggtitle("Distribution of Miles Ran in All Runs") + 
  guides(fill = FALSE) +
  facet_grid(~ MarathonName)
```

Just like [last year](https://stevenewns.netlify.com/2017/04/18/marathon-training-plan-data-analysis/), I again can see the actual marathon itself and my one 24 mile run, the longest **Long Run** of the plan, all the way to the right of the plot. It also looks like I had less runs that were between 16-18 miles and more runs between 22-24 miles this year. This distribution is right/positively-skewed, with the majority of the runs being less than 12 miles. Also, as expected after choosing a higher mileage plan, the 2017 histogram has some taller bars, indicating a larger number of runs overall, with bars for the same distance being noticeably higher in 2017 compared to 2016.

The majority of my runs in this 2017 training block were around 4-6 miles, with the next highest frequency being from 10-12 miles. The fact that most of my runs were from 4-6 miles is not surprising when noting that the majority of my runs were recovery runs, which went from a minimum of 3 miles up to a maximum of 7 miles, for them most part. Sometimes I combined two recovery runs into one run due time constraints and moreso to my regrettable obsession with hitting as much of my planned mileage as possible at the expense of truly recovering from hard efforts.

```{r, un type counts, echo = F}
philly %>%
  group_by(MarathonName,RunCat) %>%
  summarize(Count = n()) %>%
  spread(key = RunCat, value = Count) %>%
  kable() # print as table
```

The above shows that for 2017, I actually had less workouts, long runs, and middle long runs (runs that're longer than a "general aerobic" run but shorter than a long run), but more recovery runs and general aerobic runs. This makes me think that, following the plan *correctly*, I would've been taking it a bit easier overall in this build-up, with a higher number of easier runs.. I believe the lower numbers for the workouts were due to me missing these runs thanks to injury. For example, let's look at those runs that fall under `Misc`:
```{r Misc runs, echo = F}
philly %>%
  filter(RunCat == "Misc") %>%
  select(Name,Date,RunCat) %>%
  kable()
```

4 of these runs were the warm up and cool downs to some tune-up race workouts, but the other 2 were runs I kept short due to injury, one physical, one mental. As mentioned earlier, I strained my quad twice in this build-up. I took a couple of days off in each instance, as I started to realize that I didn't have to hit *every* run on the schedule during the span of this plan and pushing through legitimate injury and not just some soreness or a niggle could have some legit long-term consequences. I can see the periods I took off highlighted by the empty spaces in the middle of September and October when looking at a plot of runs.
```{r show rest days, echo = FALSE, fig.align='center'}
philly %>%
  filter(Marathon == "ph17") %>%
  ggplot(aes(Date, Distance)) + 
    geom_bar(stat="identity", fill = "green", colour = "black") +
    theme_bw() + 
    xlab("Date") + 
    ylab("Miles") + 
    ggtitle("Runs Over Time") +
    guides(fill = FALSE) +
    coord_cartesian(xlim = c(as.POSIXct("2017-09-05", format = "%Y-%m-%d"),
                             as.POSIXct("2017-10-25", format = "%Y-%m-%d")))
```

That *very* tiny bar around September 14th was where I hurt my quad for the first time within a mile and a half of the planned run, with the run the following day being cut short after 10 miles when the pain came back (again, due to my stubbornness). Then again, in the second half of October, the same pain came back right before a tune-up race workout, so I took 2 days off to be safe and avoid any further aggrivation of my quad so as to not miss another workout.

Now, to look at the summary of both marathons plans' overall distance data:
```{r distance summary, echo = F}
philly %>%
  group_by(MarathonName) %>%
  select(Distance) %>%
  summarize(Mean = mean(Distance), Median = median(Distance), StdDev = sd(Distance),
            Min = min(Distance), Max = max(Distance), Count = n()) %>%
  kable()
```

So, since I have a skewed distribution, I'd want to look at median to compare measures of center. I can see the median number of miles ran in a run for 2017 is 7 miles, which is lower than 10 miles for last year (this year's mean was also lower), which I can infer was due to the higher number of the shorter recovery runs this time around, especially during the double-run days. And again, we see that the max distance here is, of course, the actual marathon, even though something must have been up with my GPS watch or the course, as it says I ran about .15 miles moreso than the actual race distance. Like I needed *that*.

Now let's look at the total number of miles ran each month, with an initial expectation to see the total rise month by month.
```{r miles by month, echo = FALSE, fig.align='center'} 
#miles by month bars
ggplot(philly, aes(Month, Distance, fill = Month)) + 
  geom_bar(stat="identity") +
  theme_bw() + 
  xlab("") + 
  ylab("Total Miles") + 
  guides(fill=FALSE) +
  ggtitle("Total Miles by Month") +
  facet_grid( ~ MarathonName)
```

Somewhat against what was expected, my total mileage in November was actually shorter this time around, while the other months all did have higher totals. It makes sense in hindsight that September and October hada bit lower of total mileage than August, as August was the only month in which I did not take time off due to injury. But, I believe I also took some more days off in November this year because I was feeling quite fatigued and was worried I would go into the race too beat up, which I still think I did in the end (but it could've been worse, right?).

```{r, echo = F}
philly %>%
  filter(Month == "Nov") %>%
  group_by(MarathonName) %>%
  summarize(Count = n()) %>%
  kable() # print as table
```

Looks like I did look to rest up a bit more this year, so maybe I'm learning.

### *Cadence*

Last year, my cadence generally increased month over month, albeit *barely*, and ended up averaging between 170 and 180. Let's look at how I fared this year.

```{r cadence by month, echo = FALSE, fig.align='center'} 
#avg. cadence grouped by month
ggplot(data = philly, aes(Month, Avg.Cadence)) + 
  geom_jitter(aes(colour = Month)) +
  geom_boxplot(aes(fill = Month), outlier.colour = "black", alpha = 0.5) +
  theme_bw() + 
  xlab("") + 
  ylab("Cadence (Steps/Min)") + 
  theme(legend.position = "none") + 
  ggtitle("Cadence by Month") + 
  facet_grid(~ MarathonName)
```

Much more consisten cadence this time aorund, and much higher = GOOD, better form + focus on form, decrease in last 2 months???????, but still optimal

barring those outliers. I would assume the outliers were mainly recovery runs, as I was mainly concerned with keeping my heart rate down so I could actually recover on them than I was with making sure my cadence was optimal. I could investigate to see if this was due to having more speed workouts as the plan progressed, in which I would assume my cadence was typically higher), or could it have been due to improved form from an ever-increasing volume.
Another important metric for runners is their **cadence**, which is the number of steps taken per minute. The general consensus for a "good" cadence (running in the most efficient manner to maximize output while minimzing effort) seems to be anywhere from 160 to 180 steps per minute, with more advanced and elite runners leaning towards the higher end.
s
## Heart Rate

Another metric to look at would be my **average heart rate** during runs over the course of my training. Compared to the rise of my cadence, I would expect that my average heart rate would have decreased over time, as my fitness would have increased due to higher mileage and an increasing number of workouts.

```{r heart rate over time, echo = FALSE, fig.align='center'}
philly %>%
  #filter(Marathon == "ph16") %>%
  ggplot(data = , aes(as.POSIXct(paste(month(Date),'/',day(Date), sep=""),format="%m/%d"), Avg.HR)) + 
    geom_line(aes(group=1, colour = MarathonName)) +
    geom_smooth(method = "lm", se = T, aes(colour = MarathonName)) + 
    theme(axis.text.x = element_blank()) +
    theme_bw() +
    xlab("Time") + 
    ylab("Average Heart Rate") + 
    ggtitle("Average Heart Rate Over Time") + 
    coord_cartesian(ylim = c(110, 160))
```
philly %>%
  filter(Marathon == "ph17") %>%
  ggplot(data = , aes(Date, Avg.HR)) + 
    geom_line(aes(group=1)) +
    geom_smooth(method = "lm", se=T) + 
    theme(axis.text.x = element_blank()) +
    xlab("Time") + 
    ylab("Average Heart Rate") + 
    ggtitle("Average Heart Rate Over Time")


So, it looks like my average heart rate decreased over time, barring two random extreme drops (shout-out again to my heart rate monitor). Let's check it out by month.

```{r HR by month boxplot, echo = FALSE, fig.align='center'}
#avg. HR grouped by month
ggplot(data = philly, aes(Month, Avg.HR)) + 
  geom_jitter(aes(colour = Month)) +
  geom_boxplot(aes(fill = Month), outlier.colour = "black", alpha = 0.5) + 
  theme_bw() +
  theme(legend.position = "none") + 
  xlab("Month") + 
  ylab("Avg. Heart Rate") + 
  ggtitle("Average Heart Rate per Month") + facet_grid(~ MarathonName)
```

Opposite to cadence, had more variance this year, but 1st 4 months were all lower, less outliers this time, November similar


#So we can see that my heart rate had generally decreased month over month, albeit *barely*. *Again*. Now while I would hope it was due to increased fitness (and I still believe that to be the case, just by how I felt during my runs), the drops in temperature as the seasons moved from summer to fall also may have played a part. Since it would have been cooler out, the body would not have been working as hard to cool itself down during my runs, so my heart rate would not have been as high. Maybe finding the historical temperature data and bringing it in could bring some insights into this question.

Now let's look at cadence and heart rate by Run Type as well for comparisons.

```{r cadence by run type, echo = FALSE, fig.align='center'} 
#avg. cadence grouped by month
philly %>%
  filter(RunType != "Race",
         RunType != "Misc") %>%
  ggplot(aes(RunType, Avg.Cadence)) + 
    geom_jitter(aes(colour = RunType)) +
    geom_boxplot(aes(fill = RunType), outlier.colour = "black", alpha = 0.5) +
    theme_bw() +
    theme(legend.position = "none") + 
    scale_colour_brewer(palette = "Set1") +
    scale_fill_brewer(palette = "Set1") +
    xlab("Run Type") + 
    ylab("Cadence") + 
    guides(fill=FALSE) +
    coord_flip() + 
    ggtitle("Cadence per Run Type") +
    facet_grid(~ MarathonName)
```

Again, higher less variance, Long run had highest, workour lowest w/ most outliers *recovery jogs), recovery lowest (shuffling)

#We can ignore the **Race** run type, since it's only one race. But we can still see that it was either my maximum cadence, or the second or third highest after those 2 quickest workout cadences. We can also see that my recovery runs had the least variability, and recovery runs, as well as normal runs, were in the lower 170's. I also expected my workouts to have the highest cadence, but it has the lowest median and the widest variety. I can only assume that this was due to recovery sections of interval runs, or warm-ups and cooldowns during tempo runs which were *much* slower and relaxed than even recovery runs. 

Now let's see if cadence and heart rate seem to have anything to do with each other.

```{r cadence by hr, echo = FALSE, messages = FALSE, fig.align='center'}
ggplot(data = philly, aes(Avg.Cadence, Avg.HR)) + 
  geom_point(aes(colour = RunType), na.rm = TRUE) +
  theme_bw() +
  xlab("Cadence") + 
  ylab("Average Heart Rate") + 
  scale_y_continuous(limits = c(110, 160)) +
  ggtitle("Average Heart Rate by Cadence") + 
  facet_grid(~ MarathonName)
```

By looking at average heart rate by average cadence, we can see that there is no relationship at all here. I honestly expected heart rate to increase a bit as cadence increased, which it does sharply for Recovery Runs, but it actually looks to decrease as cadence increased during Normal Runs, and a bit as well during Workouts. Maybe I was more efficient in my running form than I thought during these runs. Now let's look at heart rate by runs types to see if there's some effect there.

```{r heart rate by run type, echo = FALSE, fig.align='center'}
#avg. cadence grouped by month
philly %>%
  filter(RunType != "Race",
         RunType != "Misc") %>%
  ggplot(aes(RunType, Avg.HR)) + 
    geom_jitter(aes(colour = RunType)) +
    geom_boxplot(aes(fill = RunType), outlier.colour = "black", alpha = 0.5) +
    theme_bw() +
    theme(legend.position = "none") + 
    xlab("Run Type") + 
    ylab("Avg Heart Rate") + 
    guides(fill=FALSE) +
    coord_flip() + 
    ggtitle("Average Heart Rate per Run Type") + 
    facet_grid(~ MarathonName)
```

workout hear rate similar good b/c usually have targets to higt, low variance, much lower vraiance in recovery = more consistenet even if run too hard, long runs a bit more varies this year, GA much more varies. Overall each run type lower


#As expected, my heart rate was lowest during recovery runs, but it was also quite varied. We can also see that there were 2 runs wherein my heart rate monitor was off, since my average heart rate was around 70. Also, my average heart rate was not very variable for the other 3 types of runs, excluding the race. This is good, since it means I was able to be consistent in my efforts, depending on the type of scheduled run. My Long Runs also tended to have a lower average heart rate than my "normal" runs, which I personally did not expect. But this does a make a little sense, since I was supposed to run at a bit of a slower pace so that I could run longer without bonking. Also, I did expect my heart rate to be higher during workouts, since they were designed to to push my heart rate to the max during **V02 intervals**, and was supposed to be elevated during those "comfortably hard" **tempo runs**. I can also see that there was one single workout wherein it was higher than my average heart rate during the marathon.

```{r max heart rate, echo = FALSE}
philly %>%
  filter(Marathon == "ph17") %>%
  arrange(desc(Avg.HR)) %>%
  select("Name","Date","Distance","Avg.HR","Max.HR") %>%
  head(1)
  #philly[which.max(philly[philly$Marathon =="ph17",]$Avg.HR),] %>%
  #select("Name","Date","Distance","Avg.HR","Max.HR")
```

So we can see that my max heart rate was during my a reoery rin???????? hot????? too beat up????

Let's now check out my average pace over time, split out by Run Type. I would hope that it would have decreased, just as average heart rate did, due to both increased form and increased fitness, as well as possibly due to decreased outside temperatures making it easier to run faster. 

```{r avg pace by runs, echo = FALSE, message=FALSE, fig.align='center'}
philly %>%
  filter(RunType != "Race",
         RunType != "Misc") %>%
  ggplot(aes(as.POSIXct(paste(month(Date),'/',day(Date), sep=""),format="%m/%d"),
                            Avg.Pace, colour = RunType)) + 
    geom_point() +
    geom_smooth(fill = NA) +  
    theme_bw() +
    theme(axis.text.x = element_blank(), axis.text.y = element_blank()) +
    xlab("Date") + 
    ylab("Average Pace (mile/minute)") + 
    ggtitle("Average Pace Over Time") + 
    labs(caption="") + 
    facet_grid(~ MarathonName)
```

So we see a very slight general decrease overall, but it's not very linear at all, so it does not seem to be that significant. Let's split these into seperate scatter plots by run type.

```{r avg pace by runs - seperate, echo = FALSE, message=FALSE, fig.align='center'}
philly %>%
  filter(Marathon == "ph17",
         RunType != "Race",
         RunType != "Misc") %>%
  ggplot(aes(Date, Avg.Pace, colour = RunType)) + 
    geom_point() +
    geom_smooth(fill = NA) +  
    theme_bw() +
    theme(legend.position = "none", axis.text.x = element_blank(), axis.text.y = element_blank()) +   
    xlab("Date") + 
    ylab("Average Pace (mile/minute)") + 
    ggtitle("Average Pace Over Time") + 
    labs(caption="") + 
    facet_grid(RunType ~ .)
```

And, we see that workouts had the lowest average pace, which seemed to actually decrease a tad until about halfway through the plan, but there was a variety of different workouts with different focuses, so this really isn't something we can glean anything out of. Long Runs start to decrease in average pace, possibly due to an increase in outside temperature from July to August causing me to slow down, but then we see a rapid increase, which start sto taper off at the end there. Normal runs seemed to have a more gradual increase over time, but it sped up a bit compared to at the start. Then we see that recovery runs increased down even more so compared to Long Runs, but also had a drop as temperatures cooled (or fitness increased, either or. Maybe both). There was then a quick uptick at the end there, which I would assume would be due to slowing down even more as I tapered for the race, with the 2 slowest recovery runs happening just before the race. We then see the race there, at about 7:10 min/mile, which, while I am happy with my results, I would *love* to get this down under 7:00 min/mile in my next marathon, Philly 2017, with the goal of running about 6:50 min/mile so as to break 3 hours!

```{r bar of steps, echo = FALSE, fig.align='center'}
table(philly$RunType)

philly %>%
  filter(RunType != "Race",
         RunType != "Misc") %>%
  ggplot(aes(RunType,(Avg.Cadence*((hour(Time)*60)+
                                     (minute(Time))+(second(Time)/60))))) + 
    geom_bar(aes(fill = RunType), stat = "identity") +
    theme_bw() + 
    xlab("Run Type") + 
    ylab("Steps") + 
    guides(fill=FALSE) +
    ggtitle("Total Steps Taken by Run Type") +
    facet_grid(~ MarathonName)
```
# AVERAGE BY TIME

Here we see the majority of runs I had were normal runs, with just a bit less recovery runs. But then in the bar chart, we can see that even though I only just over one quarter of the amount of long runs compared to the amount of recovery runs, the sum of steps taken during my long runs was greater than the sum of steps taken in all of my recovery runs. This makes sense, due to how much longer my long runs were, both in distance and in duration. We also see that steps taken during workouts was quite high compared to steps taken during recovery runs, despite having being just under a third of the amount of recovery runs.

Let's see if my elevation gain had any affect on my average heart rate. I expect that it would, since a larger eleveation gain meant I was climbing more, which requires more exertion, so I expect my average heart rate to be higher with a higher elevation gain.

```{r elevation and avg hr, echo = FALSE, message=FALSE, fig.align='center'}
philly %>%
  filter(RunType != "Race",
         RunType != "Misc") %>%
  ggplot(aes(Elev.Gain, Avg.HR)) + 
    geom_point(aes(colour = RunType), na.rm = TRUE) +
    geom_smooth(fill = NA, na.rm = TRUE) +
    theme_bw() + 
    xlab("Elevation Gain (ft.)") + 
    ylab("Average Heart Rate (BPM)") +
    scale_y_continuous(limits = c(110, 160)) +
    ggtitle("Average Heart Rate by Elevation Gain") +
    facet_grid(~ MarathonName)
```

So it looks like there was a very slight increase in average heart rate as elevation gain increased. And while the increase was not that large in magnitude, it seemed to be quite consistent for the majority of the x-axis. So this went in line with my expectation a bit.hing that heart rate would have been when I was pushing myself to max exertion, which would have only occured during a workout, or during the race. But since this was a marathon, and not a 5K, I will assume it was another heart rate monitor inaccuracy, which is something we just can't always prevent.

# Conclusion
That's all I can think of to check out so far. If you're reading this and can think of anything else, let me know on [Twitter](https://twitter.com/s_newns92), [GitHub](https://github.com/newns92), or [LinkedIn!](https://www.linkedin.com/in/stephen-newns/) I can't wait to add to this dataset with my training runs for Philly 2017, with the hopes of breaking 3 hours!

The code for this can be found [here](https://github.com/newns92/MarathonTrainingAnalysis/blob/master/Files/R_Analysis_script.R), as well as the code for the [cleaning and initial creation of the dataset](https://github.com/newns92/MarathonTrainingAnalysis/blob/master/Files/R_CleaningScript.R) (WARNING: Please excuse it ugliness, it was before I was aware of the tidyverse.)
 speed not staming into stamina not speed